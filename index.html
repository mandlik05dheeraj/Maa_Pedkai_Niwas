<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maa Pedkai Niwas - Renter Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0c0a18;
            background-image: radial-gradient(circle at top right, #4a0e72, transparent 40%),
                              radial-gradient(circle at bottom left, #0e2a72, transparent 40%);
            color: #e0e0e0;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6366f1; }

        /* Typography */
        .title-font { font-family: 'Orbitron', sans-serif; }
        .heading-font { font-family: 'Poppins', sans-serif; font-weight: 600; }
        h2 { color: #ffffff; letter-spacing: -0.5px; }
        h3 { letter-spacing: -0.25px; }

        /* Layout */
        .main-content {
            flex-grow: 1;
            transition: margin-left 0.3s ease-in-out;
        }

        /* Components */
        .glass-card {
            background: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.45);
        }

        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        .nav-link { color: #9ca3af; }
        .nav-link:hover { background-color: #374151; color: white; }
        .nav-link.active { background-color: #4f46e5; color: white; font-weight: 600; }

        .hidden-page { display: none; }

        .details-panel {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.5s ease-out, opacity 0.5s ease-out, margin-top 0.5s ease-out;
            margin-top: 0;
        }
        .details-panel.visible { max-height: 500px; opacity: 1; margin-top: 1rem; }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
        .btn-cyan { background-color: #06b6d4; color: white; }
        .btn-lime { background-color: #84cc16; color: white; }
        .btn-fuchsia { background-color: #d946ef; color: white; }
        .btn-gray { background-color: #4b5563; color: white; }
        .btn-indigo { background-color: #4f46e5; color: white; }
    </style>
</head>
<body class="relative min-h-screen">

    <!-- Mobile Header -->
    <header class="fixed w-full z-20 glass-effect md:hidden">
        <div class="container mx-auto px-4 sm:px-6">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-xl font-bold text-white truncate title-font">Maa Pedkai Niwas</h1>
                <button id="sidebar-toggle" class="text-white focus:outline-none">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 h-screen bg-gray-900/80 backdrop-blur-lg p-6 flex flex-col justify-between fixed z-40 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
        <div>
            <h1 class="text-2xl font-bold text-white mb-8 title-font">Maa Pedkai Niwas</h1>
            <nav id="nav-menu">
                <a href="#dashboard" class="nav-link block py-2.5 px-4 rounded transition duration-200 active">Dashboard</a>
                <a href="#archive" class="nav-link block py-2.5 px-4 rounded transition duration-200">Previous Renters</a>
                <a href="#electricity" class="nav-link block py-2.5 px-4 rounded transition duration-200">Electricity Usage</a>
                <a href="#revenue" class="nav-link block py-2.5 px-4 rounded transition duration-200">Revenue</a>
            </nav>
        </div>
        <div class="text-gray-500 text-sm">
            &copy; 2025 Maa Pedkai Niwas
        </div>
    </aside>
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>

    <!-- Main Content -->
    <div class="main-content md:ml-64 pt-16 md:pt-0">
        <main id="dashboard" class="p-4 sm:p-10 page">
            <h2 class="text-3xl font-bold mb-8 heading-font">Current Renters</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="glass-card rounded-lg p-6" data-renter-name="Rohit B. Pawar" data-renter-address="123 Tech Park, Bangalore" data-aadhaar-link="">
                    <h3 class="text-xl font-bold text-cyan-400 mb-4 heading-font">Room A</h3>
                    <div class="space-y-3 text-gray-300">
                        <p><strong>Name:</strong> Rohit B. Pawar</p>
                        <p><strong>Phone:</strong> +91 96237 27612</p>
                        <p><strong>Address:</strong>  Maharashtra</p>
                        <!-- <p><strong>Members:</strong> 2</p> -->
                    </div>
                    <div class="mt-6 space-y-2">
                        <!-- <a href="#" class="text-cyan-400 hover:text-white transition-colors duration-200 block" onclick="viewAadhaar(this)">View Aadhaar</a> -->
                        <button class="btn btn-cyan"  <a href="#" class="text-cyan-400 hover:text-white transition-colors duration-200 block" onclick="viewAadhaar(this)">View Aadhaar</a>> </button>
                        <button class="btn btn-gray">  Members: 2 </button>
                    </div>
                </div>
                <div class="glass-card rounded-lg p-6" data-renter-name="Soham Parihar" data-renter-address="456 Innovation Hub, Mumbai" data-aadhaar-link="https://drive.google.com/file/d/1yshfwbKDhZYKek_wdA3Ke3LhRuL1A6Mi/view?usp=drive_link">
                    <h3 class="text-xl font-bold text-lime-400 mb-4 heading-font">Room B</h3>
                    <div class="space-y-3 text-gray-300">
                        <p><strong>Name:</strong> Soham Parihar</p>
                        <p><strong>Phone:</strong> +91 95165 23700</p>
                        <p><strong>Address:</strong> M.P.</p>
                        <!-- <p><strong>Members:</strong> 1</p> -->
                    </div>
                    <div class="mt-6 space-y-2">
                        <!-- <a href="#" class="text-lime-400 hover:text-white transition-colors duration-200 block" onclick="viewAadhaar(this)">View Aadhaar</a> -->
                        <button class="btn btn-lime" onclick="viewAadhaar(this)><a  href="#" class="text-cyan-400 hover:text-white transition-colors duration-200 block" onclick="viewAadhaar(this)"></a>View Aadhaar > </button>
                        <button class="btn btn-gray">  Members: 1 </button>
                    </div>
                </div>
                <div class="glass-card rounded-lg p-6" data-renter-name="Ajit Kawde" data-renter-address="789 Future Towers, Pune" data-aadhaar-link="">
                    <h3 class="text-xl font-bold text-fuchsia-400 mb-4 heading-font">Room G</h3>
                    <div class="space-y-3 text-gray-300">
                        <p><strong>Name:</strong> Ajit Kawde</p>
                        <p><strong>Phone:</strong> +91 62614 19462</p>
                        <p><strong>Address:</strong> M.P.</p>
                        <!-- <p><strog>Members:</strog> 3</p> -->
                    </div>
                    <div class="mt-6 space-y-2">
                        <!-- <a href="#" class="text-fuchsia-400 hover:text-white transition-colors duration-200 block" onclick="viewAadhaar(this)">View Aadhaar</a> -->
                        <button class="btn btn-fuchsia"  <a href="#" class="text-cyan-400 hover:text-white transition-colors duration-200 block" onclick="viewAadhaar(this)">View Aadhaar</a>> </button>
                        <button class="btn btn-gray">  Members: 2 </button>
                    </div>
                </div>
            </div>
        </main>

        <main id="archive" class="p-4 sm:p-10 page hidden-page">
            <h2 class="text-3xl font-bold mb-8 heading-font">Previous Renters</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="glass-card rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-cyan-400 heading-font">Room A</h3>
                        <span id="room-a-total" class="text-sm font-bold text-cyan-300 bg-cyan-900/50 px-3 py-1 rounded-full"></span>
                    </div>
                    <ul id="room-a-list" class="space-y-4"></ul>
                </div>
                <div class="glass-card rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-lime-400 heading-font">Room B</h3>
                        <span id="room-b-total" class="text-sm font-bold text-lime-300 bg-lime-900/50 px-3 py-1 rounded-full"></span>
                    </div>
                     <ul id="room-b-list" class="space-y-4"></ul>
                </div>
                <div class="glass-card rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-fuchsia-400 heading-font">Room G</h3>
                        <span id="room-g-total" class="text-sm font-bold text-fuchsia-300 bg-fuchsia-900/50 px-3 py-1 rounded-full"></span>
                    </div>
                     <ul id="room-g-list" class="space-y-4"></ul>
                </div>
            </div>
        </main>

        <main id="electricity" class="p-4 sm:p-10 page hidden-page">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
                <h2 class="text-3xl font-bold mb-4 sm:mb-0 heading-font">Electricity Usage</h2>
                <div class="glass-card rounded-lg p-1">
                    <select id="electricityYearSelector" class="bg-transparent text-white focus:outline-none p-2">
                        <option value="2025" style="color: black;" >2025</option>
                        <option value="2024" style="color: black;" >2024</option> 
                        <option value="2023" style="color: black;" >2023</option>
                        <option value="2022" style="color: black;" >2022</option>
                        
                    </select>
                </div>
            </div>
            <div class="glass-card rounded-lg p-4 sm:p-6 mb-8">
                <h3 class="text-xl font-bold text-white mb-4 text-center heading-font">Consumption Overview</h3>
                <div class="h-80"><canvas id="electricityUsageChart"></canvas></div>
            </div>
             <div class="glass-card rounded-lg p-4 sm:p-6">
                <div class="overflow-x-auto">
                    <table class="min-w-full text-center">
                        <thead>
                            <tr>
                                <th class="py-2 heading-font">Month</th>
                                <th class="py-2">
                                    <span class="text-cyan-400 heading-font">Room A</span>
                                    <span id="elec-renter-a" class="block text-xs text-gray-400"></span>
                                </th>
                                <th class="py-2">
                                    <span class="text-lime-400 heading-font">Room B</span>
                                    <span id="elec-renter-b" class="block text-xs text-gray-400"></span>
                                </th>
                                <th class="py-2">
                                    <span class="text-fuchsia-400 heading-font">Room G</span>
                                    <span id="elec-renter-g" class="block text-xs text-gray-400"></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="electricityTableBody"></tbody>
                        <tfoot>
                            <tr class="border-t-2 border-gray-600 font-bold">
                                <td class="py-3">Total</td>
                                <td id="totalA" class="py-3 text-cyan-400"></td>
                                <td id="totalB" class="py-3 text-lime-400"></td>
                                <td id="totalG" class="py-3 text-fuchsia-400"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </main>

        <main id="revenue" class="p-4 sm:p-10 page hidden-page">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
                <h2 class="text-3xl font-bold mb-4 sm:mb-0 heading-font">Revenue</h2>
                <div class="glass-card rounded-lg p-1">
                    <select id="revenueYearSelector" class="bg-transparent text-white focus:outline-none p-2">
                        <option value="2025" style="color: black;" >2025</option>
                        <option value="2024" style="color: black;" >2024</option> 
                        <option value="2023" style="color: black;" >2023</option>
                        <option value="2022" style="color: black;" >2022</option>
                        <option value="2021" style="color: black;" >2021</option>
                        <option value="2020" style="color: black;" >2020</option>
                        <option value="2019" style="color: black;" >2019</option>
                    </select>
                </div>
            </div>
            <div class="glass-card rounded-lg p-4 sm:p-6 mb-8">
                <h3 class="text-xl font-bold text-white mb-4 text-center heading-font">Monthly Revenue Overview</h3>
                <div class="h-80"><canvas id="revenueChart"></canvas></div>
            </div>
             <div class="glass-card rounded-lg p-4 sm:p-6">
                <div class="overflow-x-auto">
                    <table class="min-w-full text-center">
                        <thead>
                            <tr>
                                <th class="py-2 heading-font">Month</th>
                                <th class="py-2">
                                     <span class="text-cyan-400 heading-font">Room A</span>
                                     <span id="rev-renter-a" class="block text-xs text-gray-400"></span>
                                </th>
                                <th class="py-2">
                                    <span class="text-lime-400 heading-font">Room B</span>
                                    <span id="rev-renter-b" class="block text-xs text-gray-400"></span>
                                </th>
                                <th class="py-2">
                                    <span class="text-fuchsia-400 heading-font">Room G</span>
                                    <span id="rev-renter-g" class="block text-xs text-gray-400"></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="revenueTableBody"></tbody>
                        <tfoot>
                            <tr class="border-t-2 border-gray-600 font-bold">
                                <td class="py-3">Total</td>
                                <td id="revenueTotalA" class="py-3 text-cyan-400"></td>
                                <td id="revenueTotalB" class="py-3 text-lime-400"></td>
                                <td id="revenueTotalG" class="py-3 text-fuchsia-400"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <div class="glass-card rounded-lg p-6 mt-8 text-center">
                <h3 class="text-2xl font-bold text-white heading-font">Total Annual Revenue (<span id="grandTotalYear">2025</span>)</h3>
                <p id="grandTotalAmount" class="text-4xl font-extrabold text-emerald-400 mt-2"></p>
            </div>
        </main>
    </div>


    <script>
        let currentRenter = {};
        let electricityUsageChartInstance = null;
        let revenueChartInstance = null;

        const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        
        const electricityData = {
            "2025": {"Room A": [29, 31, 30, 31, 59, 12, 5, 32, 0, 0, 0, 0], "Room B": [48, 56, 54, 41, 55, 60, 64, 64, 0, 0, 0, 0], "Room G": [70, 58, 44, 41, 43, 116, 74, 68, 0, 0, 0, 0]},
            "2024": {"Room A": [14, 24, 16, 15, 41, 46, 30, 12, 20, 10, 14, 16], "Room B": [14, 27, 24, 26, 69, 12, 40, 51, 32, 27, 8, 19], "Room G": [20, 0, 45, 68, 48, 69, 10, 86, 2, 32, 25, 39]},
            "2023": {"Room A": [100, 95, 90, 85, 102, 110, 105, 108, 100, 95, 90, 88], "Room B": [130, 142, 125, 120, 135, 145, 140, 138, 132, 128, 125, 120], "Room G": [88, 82, 88, 78, 92, 98, 95, 90, 85, 80, 78, 75]}
        };
        
        const revenueData = {
            "2025": {"Room A": [10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000], "Room B": [12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000], "Room G": [15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000]},
            "2024": {"Room A": [9500, 9500, 9500, 9500, 9500, 9500, 9500, 9500, 9500, 9500, 9500, 9500], "Room B": [11500, 11500, 11500, 11500, 11500, 11500, 11500, 11500, 11500, 11500, 11500, 11500], "Room G": [14000, 14000, 14000, 14000, 14000, 14000, 14000, 14000, 14000, 14000, 14000, 14000]},
            "2023": {"Room A": [9000, 9000, 9000, 9000, 9000, 9000, 9000, 9000, 9000, 9000, 9000, 9000], "Room B": [11000, 11000, 11000, 11000, 11000, 11000, 11000, 11000, 11000, 11000, 11000, 11000], "Room G": [13500, 13500, 13500, 13500, 13500, 13500, 13500, 13500, 13500, 13500, 13500, 13500]}
        };

        const previousRentersData = {
            "Rohit B. Pawar": { name: "Rohit B. Pawar", room: "A", timeFrame: "Jul 2025 - Aug 2025", totalRent: 0, address: "-", phone: "+91 96237 27612", members: [{ name: "Ankit Pawar", address: "Maharashtra", phone: "+91 95277 26008" } ] },
            "kajal": { name: "Kajal Dondge", room: "A", timeFrame: "Apr 2025 - Jun 2025", totalRent: 12900, address: "-", phone: "+91 93015 11581", members: [] },
            "himanshu": { name: "Himanshu Tiwari", room: "A", timeFrame: "Sep 2023 - Mar  2025", totalRent: 69600, address: "-", phone: "+91 62650 66166", members: [{ name: "Sonam Tiwari", address: "-", phone: "+91 -" }] },
            "palkesh": { name: "Plakesh Parihar", room: "A", timeFrame: "Aug 2023 - Aug 2023", totalRent: 3800, address: "-", phone: "+91 -", members: [] },
            "radha": { name: "Radha Chouhan", room: "A", timeFrame: "Jan 2021 - Jun 2022", totalRent: 93500, address: "-", phone: "+91 -", members: [] },
            "ajay" : { name: "Ajay Yadav", room: "A", timeFrame: "Aug 2019 - Aug 2020", totalRent: 33000, address: "-", phone: "+91 -", members: [{ name: "-", address: "-", phone: "+91 -" }] },

            "soham": { name: "Soham Parihar", room: "B", timeFrame: "Feb 2023 - Aug 2025", totalRent: 0, address: "-", phone: "+91 95165 23700", members: [] },

            "ajit": { name: "Ajit Kawde", room: "G", timeFrame: "Aug 2024 - Aug 2025", totalRent: 0, address: "M.P.", phone: "+91 62614 194662 ", members: [ { name: "Arpit Kumar, address: "-", phone: "+91 73197 60261"}] },
            "narendra": { name: "Narendra Patil", room: "G", timeFrame: "Jun 2024 - Jul 2024", totalRent: 12000, address: "Maharashtra", phone: "+91 ", members: [ ] }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page');
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebarOverlay = document.getElementById('sidebar-overlay');

            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
                sidebarOverlay.classList.toggle('hidden');
            });

            sidebarOverlay.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            });

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    pages.forEach(page => page.id === targetId ? page.classList.remove('hidden-page') : page.classList.add('hidden-page'));
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    link.classList.add('active');

                    if (window.innerWidth < 768) {
                        sidebar.classList.add('-translate-x-full');
                        sidebarOverlay.classList.add('hidden');
                    }

                    if (targetId === 'electricity') updateElectricityPage();
                    if (targetId === 'revenue') updateRevenuePage();
                    if (targetId === 'archive') populatePreviousRenters();
                });
            });
            
            document.getElementById('electricityYearSelector').addEventListener('change', updateElectricityPage);
            document.getElementById('revenueYearSelector').addEventListener('change', updateRevenuePage);
            
            document.querySelector('.nav-link[href="#dashboard"]').click();
            populatePreviousRenters();
        });

        function getRenterForYear(room, year) {
            const currentYear = new Date().getFullYear();
            if (parseInt(year) >= currentYear) {
                if (room === 'A') return "Rohit B. Pawar";
                if (room === 'B') return "Soham Parihar";
                if (room === 'G') return "Ajit Kawde";
            }
            
            for (const renterId in previousRentersData) {
                const renter = previousRentersData[renterId];
                const [startMonth, startYear] = renter.timeFrame.split(' - ')[0].split(' ');
                const [endMonth, endYear] = renter.timeFrame.split(' - ')[1].split(' ');
                if (renter.room === room && year >= parseInt(startYear) && year <= parseInt(endYear)) {
                    return renter.name;
                }
            }
            return 'N/A';
        }

        function updateRenterNamesForYear(year, pagePrefix) {
            document.getElementById(`${pagePrefix}-renter-a`).textContent = getRenterForYear('A', year);
            document.getElementById(`${pagePrefix}-renter-b`).textContent = getRenterForYear('B', year);
            document.getElementById(`${pagePrefix}-renter-g`).textContent = getRenterForYear('G', year);
        }

        function updateElectricityPage() {
            const year = document.getElementById('electricityYearSelector').value;
            const data = electricityData[year];
            updateRenterNamesForYear(year, 'elec');
            updateTable('electricityTableBody', data, 'totalA', 'totalB', 'totalG', ' Units');
            updateChart(electricityUsageChartInstance, 'electricityUsageChart', data, year, (chart) => electricityUsageChartInstance = chart);
        }

        function updateRevenuePage() {
            const year = document.getElementById('revenueYearSelector').value;
            const data = revenueData[year];
            updateRenterNamesForYear(year, 'rev');
            const grandTotal = updateTable('revenueTableBody', data, 'revenueTotalA', 'revenueTotalB', 'revenueTotalG', '₹');
            updateChart(revenueChartInstance, 'revenueChart', data, year, (chart) => revenueChartInstance = chart);
            document.getElementById('grandTotalYear').textContent = year;
            document.getElementById('grandTotalAmount').textContent = `₹${grandTotal.toLocaleString('en-IN')}`;
        }

        function updateTable(bodyId, data, totalAId, totalBId, totalGId, suffix) {
            const tableBody = document.getElementById(bodyId);
            tableBody.innerHTML = '';
            let totals = { A: 0, B: 0, G: 0 };
            const formatter = new Intl.NumberFormat('en-IN');

            months.forEach((month, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-800 hover:bg-gray-800/50';
                
                const valA = data["Room A"][index];
                const valB = data["Room B"][index];
                const valG = data["Room G"][index];

                totals.A += valA;
                totals.B += valB;
                totals.G += valG;

                row.innerHTML = `
                    <td class="py-3 font-semibold">${month}</td>
                    <td>${suffix === '₹' ? '₹' : ''}${formatter.format(valA)}${suffix !== '₹' ? suffix : ''}</td>
                    <td>${suffix === '₹' ? '₹' : ''}${formatter.format(valB)}${suffix !== '₹' ? suffix : ''}</td>
                    <td>${suffix === '₹' ? '₹' : ''}${formatter.format(valG)}${suffix !== '₹' ? suffix : ''}</td>
                `;
                tableBody.appendChild(row);
            });

            document.getElementById(totalAId).textContent = `${suffix === '₹' ? '₹' : ''}${formatter.format(totals.A)}${suffix !== '₹' ? suffix : ''}`;
            document.getElementById(totalBId).textContent = `${suffix === '₹' ? '₹' : ''}${formatter.format(totals.B)}${suffix !== '₹' ? suffix : ''}`;
            document.getElementById(totalGId).textContent = `${suffix === '₹' ? '₹' : ''}${formatter.format(totals.G)}${suffix !== '₹' ? suffix : ''}`;
            
            return totals.A + totals.B + totals.G;
        }
        
        function updateChart(chartInstance, canvasId, data, year, setInstance) {
            if (chartInstance) chartInstance.destroy();
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            const datasets = Object.keys(data).map(room => {
                const colors = {"Room A": ['rgba(34, 211, 238, 0.5)', 'rgba(34, 211, 238, 1)'], "Room B": ['rgba(163, 230, 53, 0.5)', 'rgba(163, 230, 53, 1)'], "Room G": ['rgba(217, 70, 239, 0.5)', 'rgba(217, 70, 239, 1)']};
                return {
                    label: `${room} (${year})`,
                    data: data[room],
                    backgroundColor: colors[room][0],
                    borderColor: colors[room][1],
                    borderWidth: 1
                }
            });

            const newChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: months, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, ticks: { color: '#9CA3AF' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                        x: { ticks: { color: '#9CA3AF' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                    },
                    plugins: { legend: { labels: { color: '#F9FAFB' } } }
                }
            });
            setInstance(newChart);
        }

        function calculateStayDuration(timeFrameString) {
            const parts = timeFrameString.split(' - ');
            const startDate = new Date(parts[0]);
            const endDate = new Date(parts[1]);
            endDate.setMonth(endDate.getMonth() + 1, 0);
            let years = endDate.getFullYear() - startDate.getFullYear();
            let months = endDate.getMonth() - startDate.getMonth() + 1;
            if (months < 0) {
                years--;
                months += 12;
            }
            if (months === 12) {
                years++;
                months = 0;
            }
            const totalMonths = years * 12 + months;
            const yearText = years > 0 ? `${years} Year${years > 1 ? 's' : ''}` : '';
            const monthText = months > 0 ? `${months} month${months > 1 ? 's' : ''}` : '';
            if (yearText && monthText) return `${yearText}, ${monthText} (${totalMonths} months)`;
            return `${yearText || monthText} (${totalMonths} months)`;
        }

        function toggleDetails(event, renterId) {
            event.preventDefault();
            const link = event.target;
            const detailsPanel = document.getElementById(`details-${renterId}`);
            const renterData = previousRentersData[renterId];
            
            if (detailsPanel.classList.contains('visible')) {
                detailsPanel.classList.remove('visible');
                link.textContent = 'View Details';
            } else {
                let membersHtml = '';
                if (renterData.members && renterData.members.length > 0) {
                    membersHtml += `<h4 class="font-bold mt-3 pt-3 border-t border-gray-700">Associated Members (${renterData.members.length})</h4>`;
                    renterData.members.forEach(member => {
                        membersHtml += `
                            <div class="mt-2 pl-2 border-l-2 border-gray-600">
                                <p><strong>Name:</strong> ${member.name}</p>
                                <p><strong>Address:</strong> ${member.address}</p>
                                <p><strong>Phone:</strong> ${member.phone}</p>
                            </div>
                        `;
                    });
                } else {
                    membersHtml = '<p class="mt-2 pt-2 border-t border-gray-700">No associated members.</p>';
                }

                detailsPanel.innerHTML = `
                    <p><strong>Address:</strong> ${renterData.address}</p>
                    <p><strong>Phone:</strong> ${renterData.phone}</p>
                    <p><strong>Stay Duration:</strong> ${calculateStayDuration(renterData.timeFrame)}</p>
                    ${membersHtml}
                `;
                detailsPanel.classList.add('visible');
                link.textContent = 'Hide Details';
            }
        }

        function populatePreviousRenters() {
            const roomLists = {
                A: document.getElementById('room-a-list'),
                B: document.getElementById('room-b-list'),
                G: document.getElementById('room-g-list')
            };
            const roomTotals = { A: 0, B: 0, G: 0 };
            const formatter = new Intl.NumberFormat('en-IN');

            for (const list of Object.values(roomLists)) {
                list.innerHTML = '';
            }

            for (const renterId in previousRentersData) {
                const renter = previousRentersData[renterId];
                roomTotals[renter.room] += renter.totalRent;
                
                const renterHtml = `
                    <li class="border-b border-gray-700 pb-3">
                        <div>
                            <div class="flex justify-between items-baseline">
                                <p class="font-semibold">${renter.name}</p>
                                <p class="text-xs font-medium text-emerald-300 bg-emerald-900/50 px-2 py-1 rounded-full">₹${formatter.format(renter.totalRent)}</p>
                            </div>
                            <p class="text-sm text-gray-400 mt-1">${renter.timeFrame}</p>
                            <a href="#" onclick="toggleDetails(event, '${renterId}')" class="text-indigo-400 hover:underline text-sm mt-1 inline-block">View Details</a>
                        </div>
                        <div class="details-panel text-sm text-gray-300 space-y-2" id="details-${renterId}"></div>
                    </li>
                `;
                roomLists[renter.room].innerHTML += renterHtml;
            }

            document.getElementById('room-a-total').textContent = `Total: ₹${formatter.format(roomTotals.A)}`;
            document.getElementById('room-b-total').textContent = `Total: ₹${formatter.format(roomTotals.B)}`;
            document.getElementById('room-g-total').textContent = `Total: ₹${formatter.format(roomTotals.G)}`;
        }

        function viewAadhaar(element) {
            const card = element.closest('.glass-card');
            const link = card.dataset.aadhaarLink;
            if (link && link.startsWith('http')) {
                window.open(link, '_blank');
            } else {
                alert('Shareable link for Aadhaar card is not set.');
            }
        }

        function openAgreementModal(button) {
            const card = button.closest('.glass-card');
            currentRenter.name = card.dataset.renterName;
            currentRenter.address = card.dataset.renterAddress;
            document.getElementById('agreementModal').classList.remove('hidden');
            document.getElementById('agreementModal').classList.add('flex');
        }

        function openReminderModal(renterName) {
            currentRenter.name = renterName;
            document.getElementById('reminderRenterName').innerText = renterName;
            document.getElementById('reminderModal').classList.remove('hidden');
            document.getElementById('reminderModal').classList.add('flex');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            
            const formDiv = modal.querySelector('div[id$="Form"]');
            const resultDiv = modal.querySelector('div[id$="Result"]');
            
            if (formDiv) {
                formDiv.style.display = 'block';
                const formElement = formDiv.querySelector('form');
                if(formElement) formElement.reset();
            }
            if (resultDiv) resultDiv.style.display = 'none';
        }

        function copyToClipboard(elementId) {
            const textarea = document.getElementById(elementId);
            textarea.select();
            document.execCommand('copy');
            alert('Copied to clipboard!');
        }

        async function callGemini(prompt, modalId, formId, loadingId, resultContainerId, resultTextId) {
            const modal = document.getElementById(modalId);
            modal.querySelector(`#${formId}`).style.display = 'none';
            modal.querySelector(`#${resultContainerId}`).style.display = 'block';
            modal.querySelector(`#${loadingId}`).style.display = 'block';
            modal.querySelector(`#${resultTextId}`).parentElement.style.display = 'none';

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;
                
                modal.querySelector(`#${loadingId}`).style.display = 'none';
                const textContainer = modal.querySelector(`#${resultTextId}`).parentElement;
                textContainer.style.display = 'block';
                textContainer.querySelector('textarea').value = text.trim();
            } catch (error) {
                console.error('Gemini API Error:', error);
                modal.querySelector(`#${loadingId}`).innerHTML = '<p class="text-red-400">Error generating content. Please try again.</p>';
            }
        }

        async function generateAgreement() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            if (!startDate || !endDate) {
                alert('Please select both start and end dates.');
                return;
            }
            const prompt = `Generate a comprehensive rental agreement for a property in India. The landlord's name is the user of this app, from Maa Pedkai Niwas. The tenant's name is ${currentRenter.name}. The property address is ${currentRenter.address}. The agreement starts on ${startDate} and ends on ${endDate}. Include standard clauses for rent amount (leave a blank for the amount), security deposit (leave a blank), maintenance, rules and regulations, and termination. The format should be professional and legally appropriate for India.`;
            await callGemini(prompt, 'agreementModal', 'agreementForm', 'loading', 'agreementResult', 'agreementText');
        }

        async function generateReminder() {
            const prompt = `Draft a polite and professional rent payment reminder message for a tenant in India. The tenant's name is ${currentRenter.name}. The message should be friendly but clear about the upcoming rent payment. Mention that the rent for the current month is due soon. Sign off from Maa Pedkai Niwas. Keep it concise and suitable for sending via text or WhatsApp.`;
            await callGemini(prompt, 'reminderModal', 'reminderForm', 'reminderLoading', 'reminderResult', 'reminderText');
        }
    </script>
</body>
</html>



